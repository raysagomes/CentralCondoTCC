generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////
// MODELOS PRINCIPAIS
//////////////////////////

model User {
  id            String         @id @default(uuid())
  name          String
  email         String         @unique
  password      String
  securityWord  String?        // üîπ Tornado opcional (flexibilidade para cria√ß√£o via painel)
  accountType   AccountType    @default(USER)
  createdAt     DateTime       @default(now())

  // üîó Relacionamentos
  projects       ProjectMember[]
  tasksAssigned  Task[]        @relation("UserTasksAssigned")
  tasksCreated   Task[]        @relation("UserTasksCreated")
  comments       Comment[]
  notifications  Notification[]
  ownedProjects  Project[]     @relation("UserOwnedProjects")
  payments       Payment[]     @relation("UserPayments")
  announcements  Announcement[]
}

enum AccountType {
  USER
  COMPANY
  ENTERPRISE
  ADM
}

//////////////////////////
// PROJETOS
//////////////////////////

model Project {
  id          String          @id @default(uuid())
  name        String
  description String?
  ownerId     String
  createdAt   DateTime        @default(now())

  // üîó Relacionamentos
  members     ProjectMember[]
  tasks       Task[]
  payments    Payment[]
  events      Event[]
  owner       User            @relation("UserOwnedProjects", fields: [ownerId], references: [id])

  // ‚öôÔ∏è Configura√ß√µes
  hasTasks     Boolean @default(true)
  hasPayments  Boolean @default(true)
  showMembers  Boolean @default(true)
}

model ProjectMember {
  id         String      @id @default(uuid())
  userId     String
  user       User        @relation(fields: [userId], references: [id])
  projectId  String
  project    Project     @relation(fields: [projectId], references: [id])
  role       MemberRole  @default(MEMBER)
  addedAt    DateTime    @default(now())

  @@unique([userId, projectId])
}

enum MemberRole {
  MEMBER
  ADMIN
}

//////////////////////////
// TAREFAS E COMENT√ÅRIOS
//////////////////////////

model Task {
  id            String      @id @default(uuid())
  title         String
  description   String?
  projectId     String
  project       Project     @relation(fields: [projectId], references: [id])
  assignedToId  String?
  assignedTo    User?       @relation("UserTasksAssigned", fields: [assignedToId], references: [id])
  createdById   String
  createdBy     User        @relation("UserTasksCreated", fields: [createdById], references: [id])
  status        TaskStatus  @default(PENDING)
  createdAt     DateTime    @default(now())
  finishedAt    DateTime?
  comments      Comment[]
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Comment {
  id        String   @id @default(uuid())
  content   String
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id])
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
}

//////////////////////////
// PAGAMENTOS
//////////////////////////

model Payment {
  id           String   @id @default(uuid())
  projectId    String?
  project      Project? @relation(fields: [projectId], references: [id])
  ownerId      String
  owner        User     @relation("UserPayments", fields: [ownerId], references: [id])
  title        String
  dueDate      DateTime
  link         String?
  paid         Boolean  @default(false)
  paidDate     DateTime?
  createdAt    DateTime @default(now())
  notifications Notification[] @relation("PaymentNotifications")
}

//////////////////////////
// EVENTOS
//////////////////////////

model Event {
  id           String   @id @default(uuid())
  projectId    String?
  project      Project? @relation(fields: [projectId], references: [id])
  title        String
  description  String?
  date         DateTime
  time         String?
  createdAt    DateTime @default(now())
  notifications Notification[] @relation("EventNotifications")
}

//////////////////////////
// NOTIFICA√á√ïES
//////////////////////////

model Notification {
  id         String            @id @default(uuid())
  userId     String?
  user       User?             @relation(fields: [userId], references: [id])
  type       NotificationType
  title      String
  message    String
  status     String            @default("unread")
  createdAt  DateTime          @default(now())

  // üîó Relacionamentos opcionais
  paymentId  String?
  payment    Payment?          @relation("PaymentNotifications", fields: [paymentId], references: [id])

  eventId    String?
  event      Event?            @relation("EventNotifications", fields: [eventId], references: [id])
}

enum NotificationType {
  PAYMENT
  EVENT
  ALERT
  GENERAL
}

//////////////////////////
// AVISOS
//////////////////////////

model Announcement {
  id         String                @id @default(uuid())
  title      String
  content    String
  priority   AnnouncementPriority  @default(NORMAL)
  authorId   String
  author     User                  @relation(fields: [authorId], references: [id])
  createdAt  DateTime              @default(now())
}

enum AnnouncementPriority {
  NORMAL
  MEDIUM
  HIGH
}
